# 🕵️‍♀️추리 수사 게임〈The Room of Lies〉
- Runpod에서 ollama EEVE 모델을 사용한 게임 만들기

## 🧩게임 기획
### 주제
용의자 및 증인과의 대화를 통해 범인을 특정하는 추리 수사 게임

### 개요
〈The Room of Lies〉는 플레이어가 프로파일러가 되어 **용의자 및 증인과의 대화를 통해 범인을 특정**하는 추리 게임

### 기술 
- **플랫폼:** Streamlit  
- **사건 및 대화 생성 모델:** EEVE-Korean-10.8B (RunPod 환경에서 ollama 사용)
- **장르:** 텍스트 기반 추리 수사 게임 

### 파일 구조
```markdown
프로젝트/
├── data/
│   ├── case_file1.json     # 생성된 '사건 파일'
│   ├── case_file2.json
│   ├── case_file3.json
│   ├── case_file4.json
│   └── case_file5.json
├── models/
│   ├── case_file.ipynb     # '사건 파일' 생성
│   ├── eeve_chat_v1.py     # '채팅' 생성 v1 (사용)
│   └── eeve_chat_v2.py     # '채팅' 생성 v2
└── streamlit/
    └── app.py              # streamlit 파일
```

### AI 역할
각 사건의 시나리오와 용의자 및 증인의 답변을 생성

| 역할 | 설명 |
|------|------|
| 사건 파일 생성 | 사건의 전반적 스토리 및 세부 정보를 포함한 사건 파일 생성 |
| 용의자(4명) 채팅 | 사건 파일을 기반으로 자신에게 불리한 부분을 숨기거나 왜곡된 진술 생성 |
| 증인 채팅 | 사건에 대한 사실 기반의 증언 제공 (거짓 없이 진실만 말함) |

- 증인 프롬프트는 용의자 진술까지 참고하여 교차 검증이 가능하며 추리에 도움이 되는 진술을 하도록 구성

### Streamlit 구조
- 사건 소개 페이지: 사건 선택 | 사건 파일 및 신문 스크랩 확인
- 증거물 페이지: 증거물 정보 및 이미지 확인
- 용의자 심문 페이지: 용의자와의 대화 
- 증인 진술 페이지: 증인과의 대화
- 엔딩 페이지: 범인 지목 후 결과 확인 

---

## 🎦게임 설명

**사건 파일 생성**
- AI가 사건 시나리오를 생성
- 포함 요소: 
    - 사건 개요: 사건명, 범행 시간, 범행 장소, 범행 유형, 피해자
    - 신문 기사: 기사 제목, 기사 내용(사건 개요 요약)
    - 증거물: 증거명, 발견 위치, 설명
    - 용의자: 이름, 관계, 알리바이, 의심점
    - 진실(AI 내부 참고용): 진짜 범인, 결정적 증거

**패널티** 
- 2회 이상 오답 시 패배 (미해결 엔딩)

**게임 진행 순서**
1. **사건 선택 및 열람:** 
    - 생성된 5개 사건 중 하나 선택하여 '사건 개요, 신문 기사, 증거물' 등을 확인
2. **용의자 심문:**  
    - 플레이어는 수집한 단서를 바탕으로 용의자에게 질문을 유도
3. **목격자 진술:** 
    - 용의자 심문 후 궁금한 점을 질문하여 용의자 진술과 교차 확인(크로스 체크)
4. **추리:**  
    - 증인/용의자와의 대화를 통해 수집한 단서와 모순점을 분석하여 범인 특정  
5. **결정:**  
    - 범인 지목 → 결과 확인  
    - 정답이면 ‘사건 해결’, 오답이면 ‘미해결 엔딩’ 


---

## ⚠️트러블슈팅
1. **모델이 불완전한 JSON 반환:**
    - eeve 모델이 json형식을 일정하게 반환해주지 않고 줄바꿈, 쉼표 등을  잘못 반환하는 경우가 있음 
    - [해결] json.loads()로 파싱하여 동일한 형식으로 변환

2. **다섯 개 사건 생성 실패:**
    - 다섯개의 사건을 반환하도록 프롬프트에 작성한 결과 원하는 반환 결과를 얻지 못함 
    - [해결] 다섯개의 사건명을 리스트로 두고 for문으로 개별 호출

3. **append 시 문자열 저장**
    - for문을 돌린 모델 출력 결과를 빈 리스트에 append()로 추가할 경우 딕셔너리 형식이 아닌 str 형식으로 저장됨 
    - [해결] 따라서 for문을 돌릴 때마다 출력 결과를 개별 파일에 저장

4. **증인 진술의 환각(Hallucination)**
    - 채팅에서 할루시네이션 방지를 위해 prompt에 다음과 같은 문장을 추가함
    - [해결] "[사건 정보]에 없는 내용은 만들어내지 말고 필요하면 "기억나지 않아요"라고 답해야 합니다."

---

## 💡발전 과제
1. 플레이 시간 제한
2. 용의자의 답변과 증인 및 사건 파일을 크로스 체크하여 용의자 답의 신뢰도를 알려줌 
-> 가장 모순이 많은 용의자 탐지
3. 용의자 프로필 사진 추가
4. 단서 이미지 변경
